<div class="map" th:fragment="map">
  <div id="map"></div>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
  <script th:inline="javascript">
    var markerOptions = {
      url: "/img/customIcon.png",
      anchor: [0.5, 0],
    };
    var map = new SITNA.Map("map", {
      controls: {
        click: {
          active: true,
          callback: function (coord) {
            $.ajax({
              url: "/maper",
              type: "GET",
              data: { y: coord[1], x: coord[0] },
              cache: false,
              timeout: 1000,
              dataType: "text",
              success: function (data) {
                $('#town').text(data);
              },
              error: function (e) {
                alert("An error ocurred trying to get the town");
              }
            });
            map.addMarker(coord, markerOptions);
            $("#lat").text(coord[1]);
            $("#lng").text(coord[0]);
          },
        },
      },
      crs: "EPSG:4326",
      baseLayers: [SITNA.Consts.layer.IDENA_CADASTER],
      initialExtent: [-2.8482, 41.7891, -0.32135, 43.5578],
      maxExtent: [-2.8482, 41.7891, -0.32135, 43.5578],
      zoom: 9,
      maxZoom: 9,
    });
  </script>
</div>